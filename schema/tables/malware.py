#!/usr/bin/env python
# -*- coding:utf-8 -*-

from sqlalchemy import and_
from sqlalchemy import Column, BOOLEAN, VARCHAR, INT, TIMESTAMP
from sqlalchemy.sql import func

from schema.tables.base import BaseTable
from common.utils import guid


class Malware(BaseTable):

    __tablename__ = 'malware'

    uid = Column(VARCHAR(32), primary_key=True, default=guid)
    sha256 = Column(VARCHAR(64))
    filename = Column(VARCHAR(100))
    time = Column(TIMESTAMP)
    mtype = Column(VARCHAR(20))
    severity = Column(VARCHAR(10))
    reference = Column(VARCHAR(100))
    comment = Column(VARCHAR(600))

    @classmethod
    def add(cls, sha256, filename, time, mtype,
            severity, reference, comment):
        m = Malware()
        m.sha256 = sha256
        m.filename = filename
        m.time = time
        m.mtype = mtype
        m.severity = severity
        m.reference = reference
        m.comment = comment
        cls.db.add(m)
        cls.db.commit()
        return True

    @classmethod
    def getPage(cls):
        return [
            i.toStr() for i in cls.db.query(cls).order_by(cls.time.desc()).limit(11)
        ]
