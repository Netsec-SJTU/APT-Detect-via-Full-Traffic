基于全流量的APT检测技术研究

摘要

随着互联网的发展普及，网络对社会的影响越来越大，网络安全问题也越来越突出，并逐渐成为互联网及各项网络服务和应用进一步发展所亟需解决的问题。本课题研究了基于全流量的APT攻击检测技术，通过特征提取、流量分析等手段，实现了APT攻击的检测。

关键词 高级持续性攻击 攻击检测 网络空间安全

Research on APT Inspection Technology Based on Full-flow

Abstract

With the popularization of the Internet, the impact of the Internet on society has become greater and greater. The problem of network security has also become more and more prominent, and it has gradually become an urgent problem for the further development of the Internet and various network services and applications. This topic studies the APT attack detection technology based on full traffic, and implements APT attack detection through feature extraction and traffic analysis.

Key words: APT, Attack Detection, Cyberspace Security
第一章 绪论

1.1 课程的研究背景及意义

随着互联网的发展普及，网络对社会的影响越来越大，网络安全问题也越来越突出，并逐渐成为互联网中各项网络服务和应用进一步发展亟需解决的问题。
APT（Advanced Persistent Threat，高级持续威胁）[1]是一种新兴的攻击类型。和传统的“广撒网”的攻击方式不同，APT攻击通常只面向单一目标，且可能会综合网络钓鱼、恶意软件、社会工程、零日攻击和僵尸网络等一系列手段来完成一次APT攻击，有着隐蔽性、复杂性等特点，这使得对攻击的检测变得相当困难。
APT攻击的出现从本质上改变了全球网络空间安全形势。近年来，APT攻击已演化为国家网络空间对抗的新方式。APT攻击的实施者一般会采取多种攻击技术和攻击方式，以获取高价值敏感情报或破坏目标系统为目的。根据2017年APT分析报告[2]统计，美国、中国、沙特阿拉伯等多个国家的具有战略战术意义的重要部门如政府部门、军事机构、商业企业、高等院校等都遭受过APT攻击。目前已公开的APT攻击，如Stuxnet[3]、Duqu[4]、Flame[5]等都对互联网造成了重大危害。因此，研究一项技术来实现对APT攻击的有效检测是有意义的。
基于上述原因，我们提出了基于全流量的APT检测技术研究，旨在通过对网络流量进行实时监控，在潜在的、恶意的网络行为变得无法控制之前进行识别，避免关键部门受到损失。


网络攻击的数量在近几年来逐渐提升。
一个系统通常会使用检测系统来检测攻击。

1.2 国内外研究现状

近年来，国内外学者对APT攻击检测做了大量研究，也出现了许多有效的APT攻击检测方法。
DIMVA2017 会议上，Lamprakis[6] 等提出了一种检测APT C&C 通道的无监督机制。他们通过重构Web 请求之间的依赖关系，即Web 请求图，并过滤掉有关常规Web 浏览的节点，可以识别恶意软件请求，发现APT C&C 通道。Jiazhong Lu[7]等人则提出了基于时间间隔的APT检测机制，他们通过研究已知的公开APT数据库[8]发现APT攻击和僵尸网络有着类似的特性，即都有周期性的命令控制操作。他们对流量出现的时间间隔进行统计分析，使用已知的APT攻击流量和学校服务器的流量作为样本，通过机器学习的方式训练除了一个基于时间间隔的APT攻击检测方法。GuoDong Zhao[9]等人则从DNS方面进行研究，从DNS流量提取出了基于域名字符集、域名IP特征、域名时间特征、域名TTL等多种特征，并基于这些特征完成了一个APT攻击检测方法。


很多人用机器学习的技术来做。一个很著名的方法是使用ANN(Artificial neural network)。ANN在非线性学习复杂概念的时候非常好。[这一块的参考文献见Kistune]
这让ANN有很大的优势。

但是ANN有问题：
1）需要专家
2）需要大量的计算资源
3）要cp训练好的模型

1.3 课题研究内容

为了实现有效的APT攻击检测，基于已知模型和数据分析等方法，本课题提出了一种攻击检测系统，用以实现基于流量分析的APT攻击检测。主要的研究内容分为四个方面。

1.3.1 APT攻击技术研究

APT攻击的特征和常用手法。
常见攻击识别模型。是指实现基于对已知漏洞利用、互联网攻击常规手法和攻击工具等的了解，针对其行为特征建立模型。

1.3.2 流量提取技术

从流量中提取文件和HTTP请求流。

1.3.3 沙箱执行技术

利用沙箱执行快速准确的分析二进制可执行文件。

1.3.4 特征匹配技术

利用已知的数据库和机器学习的方式进行特征匹配。

1.4 论文结构安排

本文重点研究基于流量的APT攻击检测技术。
第一章，概述了本课题的研究背景与研究意义，简要介绍了当前国内外的研究现状，分析了本课题的研究内容与研究思路。
第二章，研究了部分APT攻击样例，介绍了常见APT攻击的特征。
第三章，从几个方面分析本课题的实现原理。分别包括流量提取技术、特征匹配技术、沙箱分析技术、基于机器学习的识别技术。
第四章，研究本系统的具体实现。
第五章，通过对之前流量的重放，分析本课题的优劣所在。
第六章，对本课题进行了总结。分析实验中出现的问题，并提出改进方法，展望了本系统的希望发展方向。


第二章 APT攻击技术研究

2.1 APT攻击实例

2.1.1 Stuxnet

``TODO``

2.1.2 Flame

``TODO``

2.1.3 Duqu

``TODO``

2.2 APT攻击技术特征

2.2.1 针对性

APT攻击的攻击手段和攻击方案均针对特定的攻击对象和目的设计。例如，代码植入阶段的钓鱼程序大多是根据特定用户的行为习惯而设计的，且恶意代码的运行环境也都适应于目标主机的操作系统。
 
2.2.2 持续性

APT攻击的实施过程包含多个阶段，攻击者多采用逐层渗透的方式突破高安全等级网络的防御系统，整个攻击过程经常长达数月到数年。
 
2.2.3 伪装性

APT攻击者经常采用多种方式来伪装自己的行为，进而规避检测。例如，攻击者在保持访问阶段和扩展行动阶段分别通过伪造合法签名和模仿正常行为的方式进行伪造

2.2.4 间接性

APT攻击过程中经常使用第三方和中间站作为媒介，而非传统的点到点攻击模式。例如，代码传入阶段的第三方钓鱼网站、初次入侵
阶段的间接执行恶意代码和保持访问阶段的远程访问工具都是 
APT攻击间接性的体现。
 
2.2.5 共享性

APT攻击组织之间互相贩卖漏洞攻击码及搭配的恶意软件在网络中越来越普遍，这表明各攻击组织之间的资源共享性逐步增强。

2.3 本章小结

第三章 攻击检测技术原理

3.1 流量提取技术

3.1.1 HTTP流提取

3.1.2 文件提取

3.2 基于特征匹配的检测

3.2.1 开源waf
3.2.2 攻击工具
3.2.3 APT IoC

3.3 基于沙箱的动态分析

3.4 基于机器学习的攻击检测 

3.4.1  ANN

ANN是多层神经元组成的，每层神经元都通过突触连接。

ANN的神经元有两种，显层和隐层。显层接受一个向量作为输入，然后可以用一个值作为偏移。


4. APT攻击检测技术

4.1 常规攻击识别模型

4.2 已知APT攻击识别模型

4.2.1 各APT攻击特征

4.3 未知APT攻击识别模型

4.3.1 Web请求

4.3.2 Malware

4.3.3 C&C

4.4 本章小结

第五章 实验

5.1 常规攻击识别实验

5.1.1 攻击流量重放

5.1.2 攻击工具攻击

5.2 已知攻击识别实验

5.2.1 APT流量重放

5.3 未知攻击识别实验

5.3.1 机器学习实验

5.3 本章小结

第六章 总结与展望

6.1 总结

6.2 展望
参考文献
谢辞

感谢老师在本课题遇到问题时，悉心解答；
感谢等文献作者在入侵检测领域做出的贡献；
感谢父母在本课题研究过程中的关心；
感谢交大与电院给我这次展示与锻炼的机会。

Research on APT Inspection Technology Based on Full-flow
